# Lab 14 #

---

The kube-prometheus repository provides tools and configurations for monitoring Kubernetes clusters using Prometheus and Grafana. It includes the Kubernetes Prometheus Operator, which deploys and manages Prometheus, Grafana, Alertmanager, and kube-state-metrics. These tools collect and store monitoring data, visualize and analyze it, and manage alerts

```
PS C:\users\dappa\devops\devops> cd k8s
PS C:\users\dappa\devops\devops\k8s> helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
"prometheus-community" has been added to your repositories
PS C:\users\dappa\devops\devops\k8s> helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "prometheus-community" chart repository
Update Complete. ⎈Happy Helming!⎈
PS C:\users\dappa\devops\devops\k8s> helm install devops prometheus-community/kube-prometheus-stack
Release devops has been cancelled.
PS C:\users\dappa\devops\devops\k8s> helm install devops prometheus-community/kube-prometheus-stack
Error: INSTALLATION FAILED: cannot re-use a name that is still in use
PS C:\users\dappa\devops\devops\k8s> helm ls
NAME    NAMESPACE       REVISION        UPDATED STATUS  CHART   APP VERSION
PS C:\users\dappa\devops\devops\k8s> helm install devops_ prometheus-community/kube-prometheus-stack
Error: INSTALLATION FAILED: release name "devops_": invalid release name, must match regex ^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$ and the length must not be longer than 53
PS C:\users\dappa\devops\devops\k8s> helm install devopsss prometheus-community/kube-prometheus-stack
NAME: devopsss
LAST DEPLOYED: Sun Feb 19 23:28:13 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
kube-prometheus-stack has been installed. Check its status by running:
  kubectl --namespace default get pods -l "release=devopsss"

Visit https://github.com/prometheus-operator/kube-prometheus for instructions on how to create & configure Alertmanager and Prometheus instances using the Operator.
PS C:\users\dappa\devops\devops\k8s>
```

![06](https://github.com/dapp-anyway/devops/blob/lab14/k8s/screenshots/06.png)

## Grafana & Screenshots ##

`minikube service devopsss-grafana`

```
PS C:\users\dappa\devops\devops\k8s> minikube service devopsss-grafana
|-----------|------------------|-------------|--------------|
| NAMESPACE |       NAME       | TARGET PORT |     URL      |
|-----------|------------------|-------------|--------------|
| default   | devopsss-grafana |             | No node port |
|-----------|------------------|-------------|--------------|
* service default/devopsss-grafana has no node port
* Starting tunnel for service devopsss-grafana.
|-----------|------------------|-------------|------------------------|
| NAMESPACE |       NAME       | TARGET PORT |          URL           |
|-----------|------------------|-------------|------------------------|
| default   | devopsss-grafana |             | http://127.0.0.1:56873 |
|-----------|------------------|-------------|------------------------|
* Opening service default/devopsss-grafana in default browser...
! Because you are using a Docker driver on windows, the terminal needs to be open to run it.
```

1-2. CPU and Memory
Kubernetes / Compute Resources / Namespace (Pods)

Unfortunately, the information on the graph is not displayed normally

![08](https://github.com/dapp-anyway/devops/blob/lab14/k8s/screenshots/08.png)

![11](https://github.com/dapp-anyway/devops/blob/lab14/k8s/screenshots/11.png)

3. General / Node Expoter / Nodes

The percentage of memory consumed is not very high

![09](https://github.com/dapp-anyway/devops/blob/lab14/k8s/screenshots/09.png)


4. General / Kubernetes / Kubelet

![07](https://github.com/dapp-anyway/devops/blob/lab14/k8s/screenshots/07.png)

5. No data for Kubernetes / Networking / Namespace (Pods)

![10](https://github.com/dapp-anyway/devops/blob/lab14/k8s/screenshots/10.png)

6. Inspect: Alerts manager dashboard

![12](https://github.com/dapp-anyway/devops/blob/lab14/k8s/screenshots/12.png)


## Create Init container ##

```
PS C:\users\dappa\devops\devops\k8s> kubectl apply -f init_container/container.yaml
pod/init-demo created
PS C:\users\dappa\devops\devops\k8s> kubectl get pod init-demo
NAME        READY   STATUS            RESTARTS   AGE
init-demo   0/1     PodInitializing   0          9s
PS C:\users\dappa\devops\devops\k8s>
```

```
PS C:\users\dappa\devops\devops\k8s> Invoke-WebRequest -Uri https://ftp.gnu.org/gnu/wget/wget-1.21.2.tar.gz -OutFile wget.tar.gz

PS C:\users\dappa\devops\devops\k8s> wget http://info.cern.ch


StatusCode        : 200
StatusDescription : OK
Content           : <html><head></head><body><header>
                    <title>http://info.cern.ch</title>
                    </header>

                    <h1>http://info.cern.ch - home of the first website</h1>
                    <p>From here you can:</p>
                    <ul>
                    <li><a href="http://info.cern.ch...
RawContent        : HTTP/1.1 200 OK
                    Connection: close
                    Accept-Ranges: bytes
                    Content-Length: 646
                    Content-Type: text/html
                    Date: Sun, 19 Feb 2023 21:39:56 GMT
                    ETag: "286-4f1aadb3105c0"
                    Last-Modified: Wed, 05 Feb 2014 ...
Forms             : {}
Headers           : {[Connection, close], [Accept-Ranges, bytes], [Content-Length, 646], [Content-Type, text/html]...}
Images            : {}
InputFields       : {}
Links             : {@{innerHTML=Browse the first website; innerText=Browse the first website; outerHTML=<A href="http://info.cern.ch/hyperte
                    xt/WWW/TheProject.html">Browse the first website</A>; outerText=Browse the first website; tagName=A; href=http://info.cer
                    n.ch/hypertext/WWW/TheProject.html}, @{innerHTML=Browse the first website using the line-mode browser simulator; innerTex
                    t=Browse the first website using the line-mode browser simulator; outerHTML=<A href="http://line-mode.cern.ch/www/hyperte
                    xt/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</A>; outerText=Browse the first we
                    bsite using the line-mode browser simulator; tagName=A; href=http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html},
                     @{innerHTML=Learn about the birth of the web; innerText=Learn about the birth of the web; outerHTML=<A href="http://home
                    .web.cern.ch/topics/birth-web">Learn about the birth of the web</A>; outerText=Learn about the birth of the web; tagName=
                    A; href=http://home.web.cern.ch/topics/birth-web}, @{innerHTML=Learn about CERN, the physics laboratory where the web was
                     born; innerText=Learn about CERN, the physics laboratory where the web was born; outerHTML=<A href="http://home.web.cern
                    .ch/about">Learn about CERN, the physics laboratory where the web was born</A>; outerText=Learn about CERN, the physics l
                    aboratory where the web was born; tagName=A; href=http://home.web.cern.ch/about}}
ParsedHtml        : System.__ComObject
RawContentLength  : 646
```

```
PS C:\users\dappa\devops\devops\k8s> ls


    Каталог: C:\users\dappa\devops\devops\k8s


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        19.02.2023     23:04                app_python
d-----        19.02.2023     23:04                devops-helm-app
d-----        19.02.2023     23:04                files
d-----        19.02.2023     23:21                init_container
d-----        20.02.2023      0:33                screenshots
-a----        19.02.2023     23:04           3774 11.md
-a----        19.02.2023     23:04           1782 12.md
-a----        19.02.2023     23:04           5396 13.md
-a----        20.02.2023      0:40           7473 14.md
-a----        19.02.2023     23:04           4404 devops-helm-app-0.1.0.tgz
-a----        19.02.2023     23:04           7767 README.md
-a----        19.02.2023     23:04           1656 secrets.yaml
-a----        20.02.2023      0:37        5004576 wget.tar.gz
```